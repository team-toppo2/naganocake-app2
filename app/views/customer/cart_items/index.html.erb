<div class="head">
  <h2>ショッピングカート</h2>
  <td><%= link_to "カートを空にする", cart_items_all_destroy_path, method: :delete, data: { confirm: '本当に消しますか？'} %></td>

 <table class="table">
 <thead>
   <tr>
    <td>商品名</td>
    <td>単価(税込)</td>
    <td>数量</td>
    <td>小計</td>
    <td></td>
  </tr>
 </thead>

 <tbody>
  <% total=0 %>
 <% @cart_items.each do |cart_item| %>
  <tr>
    <td><%= cart_item.product.name %></td>
    <td><%= cart_item.product.add_tax_price %></td>
    <td>
     <%= form_with model: cart_item, url:cart_item_path(cart_item), local: true, method: :patch do |f| %>
      <%= f.hidden_field :product_id, value: cart_item.product.id %>
      <%= f.select :product_amount,(1..10).to_a %>
      <%= f.submit "変更"%>
     <% end %>
    </td>
    <td>
     <% subtotal = (cart_item.product_amount.to_i)*(cart_item.product.add_tax_price) %>
     <%= subtotal.to_s(:delimited)  %>
    </td>
    <td><%= link_to "削除", cart_item, method: :delete, data: { confirm: '本当に消しますか？'}, class: "destroy_#{cart_item}" %></td>
  </tr>
  <% total += subtotal %>
 <% end %>
 </tbody>
</table>
<%# ここまでがカートの中身 ボーダーで表を作る%>

<td><%= link_to "買い物を続ける", products_path %></td><%# ホーム画面に戻れるリンク設定 %>
<td>合計金額</td>
<td><%= total.to_s(:delimited)  %></td>


<div class="information">
<td><%= link_to "情報入力に進む", new_order_path %><td>
</div>